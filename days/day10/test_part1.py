import pytest
from .day10lib import parse_points, points_between
from .part1 import find_most_visibility


# cases:
# - +dx +dy
# - -dx -dy
# - +dx -dy
# - -dx +dy
@pytest.mark.parametrize(
    "a,b,ps",
    [
        ((1, 1), (7, 9), [(4, 5)]),  # +dx, +dy
        ((3, 3), (1, 1), [(2, 2)]),  # -dx, -dy
        ((3, 3), (1, 5), [(2, 4)]),  # -dx, +dy
        ((1, 5), (3, 3), [(2, 4)]),  # +dx, -dy
        ((1, 1), (3, 1), [(2, 1)]),  # horizontal
        ((1, 1), (1, 3), [(1, 2)]),  # vertical
    ],
)
def test_line_to(a, b, ps):
    assert points_between(a, b) == ps


@pytest.mark.parametrize(
    "data,nvisible,p",
    [
        (
            """
            .#..#
            .....
            #####
            ....#
            ...##
            """,
            8,
            (3, 4),
        ),
        (
            """
            ......#.#.
            #..#.#....
            ..#######.
            .#.#.###..
            .#..#.....
            ..#....#.#
            #..#....#.
            .##.#..###
            ##...#..#.
            .#....####
            """,
            33,
            (5, 8),
        ),
        (
            """
            #.#...#.#.
            .###....#.
            .#....#...
            ##.#.#.#.#
            ....#.#.#.
            .##..###.#
            ..#...##..
            ..##....##
            ......#...
            .####.###.
            """,
            35,
            (1, 2),
        ),
        (
            """
            .#..#..###
            ####.###.#
            ....###.#.
            ..###.##.#
            ##.##.#.#.
            ....###..#
            ..#.#..#.#
            #..#.#.###
            .##...##.#
            .....#.#..
            """,
            41,
            (6, 3),
        ),
        (
            """
            .#..##.###...#######
            ##.############..##.
            .#.######.########.#
            .###.#######.####.#.
            #####.##.#.##.###.##
            ..#####..#.#########
            ####################
            #.####....###.#.#.##
            ##.#################
            #####.##.###..####..
            ..######..##.#######
            ####.##.####...##..#
            .#####..#.######.###
            ##...#.##########...
            #.##########.#######
            .####.#.###.###.#.##
            ....##.##.###..#####
            .#.#.###########.###
            #.#.#.#####.####.###
            ###.##.####.##.#..##
            """,
            210,
            (11, 13),
        ),
    ],
)
def test_part1(data, nvisible, p):
    ps = parse_points(data)
    n, p2 = find_most_visibility(ps)
    assert n == nvisible
    assert p2 == p
